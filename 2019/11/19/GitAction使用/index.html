<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>GithubAction 使用 | Vencent Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="之前静态博客源码一个仓库，生成的github page在另一个仓库，并且使用Travis自动部署)。 现在使用github action替代使用。 代码大概也类似 新建源码仓库我把源码仓库（名字暂时叫hexo）设置为私有仓库，不对外开放，因为Action里面会填写token，然后静态网页代码仓库（xxxx.github.io）也就是网站主目录放在另外一个仓库 所以hexo仓库大概长这样  xxx.">
<meta name="keywords" content="code">
<meta property="og:type" content="article">
<meta property="og:title" content="GithubAction 使用">
<meta property="og:url" content="http://yoursite.com/2019/11/19/GitAction使用/index.html">
<meta property="og:site_name" content="Vencent Blog">
<meta property="og:description" content="之前静态博客源码一个仓库，生成的github page在另一个仓库，并且使用Travis自动部署)。 现在使用github action替代使用。 代码大概也类似 新建源码仓库我把源码仓库（名字暂时叫hexo）设置为私有仓库，不对外开放，因为Action里面会填写token，然后静态网页代码仓库（xxxx.github.io）也就是网站主目录放在另外一个仓库 所以hexo仓库大概长这样  xxx.">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://tvax1.sinaimg.cn/large/c1b251b3gy1g93dtj1vg6j210p0cx0u2.jpg">
<meta property="og:image" content="https://tva2.sinaimg.cn/large/c1b251b3gy1g93dux4ygbj211y0c375g.jpg">
<meta property="og:updated_time" content="2024-11-18T05:41:34.317Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GithubAction 使用">
<meta name="twitter:description" content="之前静态博客源码一个仓库，生成的github page在另一个仓库，并且使用Travis自动部署)。 现在使用github action替代使用。 代码大概也类似 新建源码仓库我把源码仓库（名字暂时叫hexo）设置为私有仓库，不对外开放，因为Action里面会填写token，然后静态网页代码仓库（xxxx.github.io）也就是网站主目录放在另外一个仓库 所以hexo仓库大概长这样  xxx.">
<meta name="twitter:image" content="https://tvax1.sinaimg.cn/large/c1b251b3gy1g93dtj1vg6j210p0cx0u2.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Vencent Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/typing.css">
</head>
</html>
  
    <body>
  
      <div id="container" class="container">
        <article id="post-GitAction使用" class="article article-type-post" itemscope itemprop="blogPost">
  <header id="header" class="header">
  <nav id="main-nav" class="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
    
  </nav>
</header>

  <hr/>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      GithubAction 使用
    </h1>
  

      </header>
    
    <div class="article-entry typo" itemprop="articleBody">
      
        <p>之前静态博客源码一个仓库，生成的github page在另一个仓库，并且<a href="[http://www.yeqinfu.com/2017/02/06/%E5%8D%9A%E5%AE%A2TravisCI%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2Hexo/](http://www.yeqinfu.com/2017/02/06/博客TravisCI自动部署Hexo/">使用Travis自动部署</a>)。</p>
<p>现在使用github action替代使用。</p>
<p>代码大概也类似</p>
<h3 id="新建源码仓库"><a href="#新建源码仓库" class="headerlink" title="新建源码仓库"></a>新建源码仓库</h3><p>我把源码仓库（名字暂时叫hexo）设置为私有仓库，不对外开放，因为Action里面会填写token，然后静态网页代码仓库（xxxx.github.io）也就是网站主目录放在另外一个仓库</p>
<p>所以hexo仓库大概长这样</p>
<p><img src="https://tvax1.sinaimg.cn/large/c1b251b3gy1g93dtj1vg6j210p0cx0u2.jpg" alt="image"></p>
<p>xxx.github.io仓库长这样</p>
<p><img src="https://tva2.sinaimg.cn/large/c1b251b3gy1g93dux4ygbj211y0c375g.jpg" alt="image"></p>
<h3 id="本地搭建Hexo"><a href="#本地搭建Hexo" class="headerlink" title="本地搭建Hexo"></a>本地搭建Hexo</h3><p>这个就略过了，官网教程执行就可以了。</p>
<h3 id="新增Action"><a href="#新增Action" class="headerlink" title="新增Action"></a>新增Action</h3><p>我们在hexo的仓库新增一个action</p>
<p>代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">name: Build and Deploy</span><br><span class="line"></span><br><span class="line">on: [push]</span><br><span class="line"></span><br><span class="line">jobs:</span><br><span class="line"></span><br><span class="line">  build-and-deploy:</span><br><span class="line"></span><br><span class="line">    runs-on: ubuntu-latest</span><br><span class="line"></span><br><span class="line">    strategy:</span><br><span class="line"></span><br><span class="line">      matrix:</span><br><span class="line"></span><br><span class="line">        node-version: [10.x]</span><br><span class="line"></span><br><span class="line">    steps:</span><br><span class="line"></span><br><span class="line">      - uses: actions/checkout@v1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      - name: Use Node.js $&#123;&#123; matrix.node-version &#125;&#125;</span><br><span class="line"></span><br><span class="line">        uses: actions/setup-node@v1</span><br><span class="line"></span><br><span class="line">        with:</span><br><span class="line"></span><br><span class="line">          node-version: $&#123;&#123; matrix.node-version &#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      - name: Configuration environment</span><br><span class="line"></span><br><span class="line">        run: |</span><br><span class="line"></span><br><span class="line">          git config --global user.name &quot;xxx&quot;</span><br><span class="line"></span><br><span class="line">          git config --global user.email &quot;xxxx@email.com&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      - name: Install dependencies</span><br><span class="line"></span><br><span class="line">        run: |</span><br><span class="line"></span><br><span class="line">          npm i -g hexo-cli</span><br><span class="line"></span><br><span class="line">          npm i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      - name: Deploy hexo</span><br><span class="line"></span><br><span class="line">        run: |</span><br><span class="line"></span><br><span class="line">          hexo g</span><br><span class="line"></span><br><span class="line">      - name: push to github.io</span><br><span class="line"></span><br><span class="line">        env:</span><br><span class="line"></span><br><span class="line">          GIT_TOKEN: replace_yours</span><br><span class="line"></span><br><span class="line">          GH_REF: github.com/xxx/xxx.github.io.git</span><br><span class="line"></span><br><span class="line">        run: |</span><br><span class="line"></span><br><span class="line">          cd ./public</span><br><span class="line"></span><br><span class="line">          git init</span><br><span class="line"></span><br><span class="line">          git add .</span><br><span class="line"></span><br><span class="line">          git commit -m &quot;update docs&quot;</span><br><span class="line"></span><br><span class="line">          git push --force --quiet &quot;https://$&#123;GIT_TOKEN&#125;@$&#123;GH_REF&#125;&quot; master:master</span><br></pre></td></tr></table></figure>
<p>可以看个大概，第一行脚本名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">on: [push]</span><br></pre></td></tr></table></figure>
<p>触发条件是每次这个hexo仓库被push的时候，就会触发</p>
<p>然后可以看到很多任务被执行</p>
<ul>
<li>检出这个仓库代码</li>
<li><p>配置nodejs环境</p>
</li>
<li><p>配置git环境</p>
</li>
<li>配置hexo环境</li>
<li>hexo g的生成命令</li>
<li>生成后我们知道多出一个public文件夹</li>
<li>然后进入public文件夹对这个文件夹内容进行git初始化</li>
<li>然后强制推到我们指定的github pager的地址</li>
</ul>
<p>注意，这里需要自己去获取git_token，生成后填写进脚本，不能暴露，因为这个token有提交代码权限，所以这里把源码项目设置为私库。</p>

      
    </div>
    <footer class="article-footer">
      <ul class="article-meta">
        <li>
          <span class="label">Published Date:</span>
          <a href="/2019/11/19/GitAction使用/" class="article-date">
  <time datetime="2019-11-19T09:00:00.000Z" itemprop="datePublished">2019-11-19</time>
</a>

        </li>
        
        
          <li>
            <span class="label">Tag:</span>
            
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/code/">code</a></li></ul>


          </li>
        
        <hr/>
      </ul>
    </footer>
  </div>
  
    
<nav id="article-nav" class="article-nav">
  
    <a href="/2020/02/01/Rxjava原理/" id="article-nav-newer" class="article-nav-link-wrap newer">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          rxjava基本使用
        
      </div>
    </a>
  
  
    <a href="/2019/05/27/自定view-花花草草/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">自定义view-花花草草</div>
    </a>
  
</nav>


  
</article>




      </div>
      
    <footer id="footer" class="post-footer footer">
      <hr/>
      <div id="footerContent" class="footer-content">
        <p>老铁，我是底线</p>


      </div>
    </footer>

      

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/typing.js"></script>
<!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->







    </div>
  </body>
</html>
