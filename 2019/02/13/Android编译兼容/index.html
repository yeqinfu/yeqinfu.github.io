<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>Android编译兼容性 | Vencent Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="区别minSdkVersion，targetSdkVersion，compileSdkVersionminSdkVersion好理解，略。 targetSdkVersion这个决定了应用在实际的操作系统中是否开启兼容模式，比如targetSdkVersion=23就是android6.0中引入了动态权限申请，也就是我们如果把targetSdkVersion设置为&amp;gt;=23，举例拍照，我们就要更">
<meta name="keywords" content="android">
<meta property="og:type" content="article">
<meta property="og:title" content="Android编译兼容性">
<meta property="og:url" content="http://yoursite.com/2019/02/13/Android编译兼容/index.html">
<meta property="og:site_name" content="Vencent Blog">
<meta property="og:description" content="区别minSdkVersion，targetSdkVersion，compileSdkVersionminSdkVersion好理解，略。 targetSdkVersion这个决定了应用在实际的操作系统中是否开启兼容模式，比如targetSdkVersion=23就是android6.0中引入了动态权限申请，也就是我们如果把targetSdkVersion设置为&amp;gt;=23，举例拍照，我们就要更">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://wx4.sinaimg.cn/large/c1b251b3gy1g05r35gahpj219a0lfadi.jpg">
<meta property="og:image" content="https://wx3.sinaimg.cn/large/c1b251b3gy1g05r5f67wtj20ye038wep.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/c1b251b3gy1g05smjjkr2j20wq0lpmzj.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/c1b251b3gy1g05snmuzxfj20mw03rglx.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/c1b251b3gy1g05tykslxaj20tf0e6q4m.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/c1b251b3gy1g05txnsphpj20um06c75b.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/c1b251b3gy1g05u15z1ckj20qh0adgmv.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/c1b251b3gy1g05u35ah51j20v30ci0ua.jpg">
<meta property="og:image" content="https://wx4.sinaimg.cn/large/c1b251b3gy1g05um9tnbtj20dg04emxh.jpg">
<meta property="og:updated_time" content="2024-11-18T05:41:34.317Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android编译兼容性">
<meta name="twitter:description" content="区别minSdkVersion，targetSdkVersion，compileSdkVersionminSdkVersion好理解，略。 targetSdkVersion这个决定了应用在实际的操作系统中是否开启兼容模式，比如targetSdkVersion=23就是android6.0中引入了动态权限申请，也就是我们如果把targetSdkVersion设置为&amp;gt;=23，举例拍照，我们就要更">
<meta name="twitter:image" content="https://wx4.sinaimg.cn/large/c1b251b3gy1g05r35gahpj219a0lfadi.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Vencent Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/typing.css">
</head>
</html>
  
    <body>
  
      <div id="container" class="container">
        <article id="post-Android编译兼容" class="article article-type-post" itemscope itemprop="blogPost">
  <header id="header" class="header">
  <nav id="main-nav" class="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
    
  </nav>
</header>

  <hr/>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android编译兼容性
    </h1>
  

      </header>
    
    <div class="article-entry typo" itemprop="articleBody">
      
        <h4 id="区别minSdkVersion，targetSdkVersion，compileSdkVersion"><a href="#区别minSdkVersion，targetSdkVersion，compileSdkVersion" class="headerlink" title="区别minSdkVersion，targetSdkVersion，compileSdkVersion"></a>区别minSdkVersion，targetSdkVersion，compileSdkVersion</h4><p>minSdkVersion好理解，略。</p>
<p>targetSdkVersion这个决定了应用在实际的操作系统中是否开启兼容模式，比如targetSdkVersion=23就是android6.0中引入了动态权限申请，也就是我们如果把targetSdkVersion设置为&gt;=23，举例拍照，我们就要更改写法，不只是在清单中声明了拍照权限就可以，而是要在使用的地方去动态申请这个权限，而如果我们把targetSdkVersion设置为22，那如果设备的操作系统是23，那么当前的android设备会启动兼容模式运行你的程序，换句话说，你不用动态申请牌照权限，只要清单声明就可以。然而，在调用相机的地方，兼容模式会帮你弹出需要相机权限这个请求。</p>
<p>compileSdkVersion就是你的代码需要用哪个sdk去编译，编译过程会检测出错误，警告或者新api特性等等</p>
<h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><p>我们假设一个app它三个值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">minSdkVersion 15</span><br><span class="line">targetSdkVersion 28</span><br><span class="line">compileSdkVersion 28</span><br></pre></td></tr></table></figure>
<p>目前28是最新的android9.0</p>
<p>也就是要兼容到15，用28编译，如果设备超过28会开启兼容模式，我们不用处理。我们要处理的是，如果调用一个函数是28才有的，那么运行在15的设备会怎样？</p>
<p><a href="https://developer.android.com/reference/android/view/package-summary" target="_blank" rel="noopener">点击这里查看每个版本新增的api</a></p>
<p><img src="https://wx4.sinaimg.cn/large/c1b251b3gy1g05r35gahpj219a0lfadi.jpg" alt="image"></p>
<p>可以看到我们把level设置为15，部分api为灰色，代表15这个版本设备没有该api，那么我们的minSdkVersion设置为15，就不能用ViewAnimationUtils，因为这个added in [API level 21]</p>
<p><img src="https://wx3.sinaimg.cn/large/c1b251b3gy1g05r5f67wtj20ye038wep.jpg" alt="image"></p>
<p>调用的时候出现警告，如果我们无视这个警告会怎样，我电脑模拟器android版本为5.1.1（level 22），一台手机8.0（level 26）</p>
<p><img src="https://ws4.sinaimg.cn/large/c1b251b3gy1g05smjjkr2j20wq0lpmzj.jpg" alt="image"></p>
<p>如图，打印了模拟器的版本是22，但是</p>
<p><img src="https://wx1.sinaimg.cn/large/c1b251b3gy1g05snmuzxfj20mw03rglx.jpg" alt="image"></p>
<p>这个类需要23，这里没做任何处理，跑到模拟器，发现并没有崩溃。换了一个模拟器也没有崩溃。看一下安卓添加快捷方式的代码</p>
<p><img src="https://ws1.sinaimg.cn/large/c1b251b3gy1g05tykslxaj20tf0e6q4m.jpg" alt="image"></p>
<p><img src="https://ws2.sinaimg.cn/large/c1b251b3gy1g05txnsphpj20um06c75b.jpg" alt="image"></p>
<p>这次终于奔溃了，我不知道没奔溃的原因，但是低版本调用高版本的api是不能忽视它在编译期间的警告的，会导致在低版本设备奔溃。</p>
<h4 id="处理这些警告"><a href="#处理这些警告" class="headerlink" title="处理这些警告"></a>处理这些警告</h4><p>第一种按照提示，根据版本代码判断来执行相应的逻辑</p>
<p><img src="https://ws2.sinaimg.cn/large/c1b251b3gy1g05u15z1ckj20qh0adgmv.jpg" alt="image"></p>
<p>第二种，根据提示添加注解</p>
<p><img src="https://ws2.sinaimg.cn/large/c1b251b3gy1g05u35ah51j20v30ci0ua.jpg" alt="image"></p>
<p>试一试第二种会不会一样奔溃，当然，结果是奔溃的，也就是说这几个注解没啥卵用。那么它是干嘛的？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@SuppressLint(&quot;NewApi&quot;）屏蔽一切新api中才能使用的方法报的android lint错误</span><br><span class="line">用@TargeApi($API_LEVEL) 使可以编译通过</span><br></pre></td></tr></table></figure>
<p>也就是说其实，这几个注解只是帮你度过编译期间的lint检查而已，并不能影响运行时。所以最好的做法还是第一种。</p>
<h4 id="targetSdkVersion，compileSdkVersion"><a href="#targetSdkVersion，compileSdkVersion" class="headerlink" title="targetSdkVersion，compileSdkVersion"></a>targetSdkVersion，compileSdkVersion</h4><p>知道targetSdkVersion是是否开启兼容模式的根本之后，想到正常情况下，这两个值是相等的。如果这两个值不相等会如何，很明显compileSdkVersion是作用于编译期间。也就是使用哪个android.jar来编码。我这里突然改成</p>
<p>compileSdkVersion=15，那编辑器直接报红色，因为压根没找到这个类。而如果compileSdkVersion&gt;targetSdkVersion会怎样？我猜可能你使用高版本api的时候编译器不会报错，但是运行会报错。总之就是targetSdkVersion=compileSdkVersion比较不会有问题，别瞎搞。</p>
<p><img src="https://wx4.sinaimg.cn/large/c1b251b3gy1g05um9tnbtj20dg04emxh.jpg" alt="image"></p>

      
    </div>
    <footer class="article-footer">
      <ul class="article-meta">
        <li>
          <span class="label">Published Date:</span>
          <a href="/2019/02/13/Android编译兼容/" class="article-date">
  <time datetime="2019-02-13T14:00:58.000Z" itemprop="datePublished">2019-02-13</time>
</a>

        </li>
        
        
          <li>
            <span class="label">Tag:</span>
            
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>


          </li>
        
        <hr/>
      </ul>
    </footer>
  </div>
  
    
<nav id="article-nav" class="article-nav">
  
    <a href="/2019/02/20/android Jetpack Lifecycle/" id="article-nav-newer" class="article-nav-link-wrap newer">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Android LifeCycle and LiveData
        
      </div>
    </a>
  
  
    <a href="/2019/02/12/Android快捷方式/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Android例子-快捷方式</div>
    </a>
  
</nav>


  
</article>




      </div>
      
    <footer id="footer" class="post-footer footer">
      <hr/>
      <div id="footerContent" class="footer-content">
        <p>老铁，我是底线</p>


      </div>
    </footer>

      

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/typing.js"></script>
<!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->







    </div>
  </body>
</html>
