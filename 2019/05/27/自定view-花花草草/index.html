<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>自定义view-花花草草 | Vencent Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="先上效果图  我不知道这个有什么用，就是想画一画。本来想画像一颗海草海草，然后随风飘摇。 目前这个，还没能飘起来，没写动画。 具体思路如下 画叶子先定义一个叶子的类。专门负责画叶子的 123456789101112/**   * 定点和根部 只要确定这两个点就可以画出叶子了   */  Point top;  Point buttom;  /*两点的距离*/  float distance;  /">
<meta name="keywords" content="android">
<meta property="og:type" content="article">
<meta property="og:title" content="自定义view-花花草草">
<meta property="og:url" content="http://yoursite.com/2019/05/27/自定view-花花草草/index.html">
<meta property="og:site_name" content="Vencent Blog">
<meta property="og:description" content="先上效果图  我不知道这个有什么用，就是想画一画。本来想画像一颗海草海草，然后随风飘摇。 目前这个，还没能飘起来，没写动画。 具体思路如下 画叶子先定义一个叶子的类。专门负责画叶子的 123456789101112/**   * 定点和根部 只要确定这两个点就可以画出叶子了   */  Point top;  Point buttom;  /*两点的距离*/  float distance;  /">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/c1b251b3gy1g3f8cm0zt6j20ct0m6ju1.jpg">
<meta property="og:updated_time" content="2024-11-18T05:41:34.321Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="自定义view-花花草草">
<meta name="twitter:description" content="先上效果图  我不知道这个有什么用，就是想画一画。本来想画像一颗海草海草，然后随风飘摇。 目前这个，还没能飘起来，没写动画。 具体思路如下 画叶子先定义一个叶子的类。专门负责画叶子的 123456789101112/**   * 定点和根部 只要确定这两个点就可以画出叶子了   */  Point top;  Point buttom;  /*两点的距离*/  float distance;  /">
<meta name="twitter:image" content="https://ws4.sinaimg.cn/large/c1b251b3gy1g3f8cm0zt6j20ct0m6ju1.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Vencent Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/typing.css">
</head>
</html>
  
    <body>
  
      <div id="container" class="container">
        <article id="post-自定view-花花草草" class="article article-type-post" itemscope itemprop="blogPost">
  <header id="header" class="header">
  <nav id="main-nav" class="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
    
  </nav>
</header>

  <hr/>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      自定义view-花花草草
    </h1>
  

      </header>
    
    <div class="article-entry typo" itemprop="articleBody">
      
        <p>先上效果图</p>
<p><img src="https://ws4.sinaimg.cn/large/c1b251b3gy1g3f8cm0zt6j20ct0m6ju1.jpg" alt="11"></p>
<p>我不知道这个有什么用，就是想画一画。本来想画像一颗海草海草，然后随风飘摇。</p>
<p>目前这个，还没能飘起来，没写动画。</p>
<p>具体思路如下</p>
<h4 id="画叶子"><a href="#画叶子" class="headerlink" title="画叶子"></a>画叶子</h4><p>先定义一个叶子的类。专门负责画叶子的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 定点和根部 只要确定这两个点就可以画出叶子了</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  Point top;</span><br><span class="line">  Point buttom;</span><br><span class="line">  <span class="comment">/*两点的距离*/</span></span><br><span class="line">  <span class="keyword">float</span> distance;</span><br><span class="line">  <span class="comment">/*两点的斜率*/</span></span><br><span class="line">  <span class="keyword">float</span> a;</span><br><span class="line">  <span class="comment">/*atan值*/</span></span><br><span class="line">  <span class="keyword">double</span> atan;</span><br><span class="line">  <span class="keyword">double</span> rotateValue;</span><br></pre></td></tr></table></figure>
<p>如题，画叶子，如果知道叶子的根部和顶部的点的位置，那么画叶子也就画出来了。</p>
<p>distance是根部和顶部的距离。a是以这两点为必经点的一个一次函数的斜率。斜率知道了那么atan的值也就知道了，那么它和x轴的偏移角度也就知道了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 把叶子画出来吧！</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> canvas</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawSelf</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">      canvas.save();</span><br><span class="line">      a = (buttom.y - top.y) * <span class="number">1.0f</span> / (buttom.x - top.x);</span><br><span class="line">      atan = Math.atan(a);</span><br><span class="line">      rotateValue = (<span class="keyword">float</span>) (atan / (<span class="number">2</span> * Math.PI) * <span class="number">360</span>);</span><br><span class="line">      <span class="keyword">if</span> (atan&lt;<span class="number">0</span>)&#123;</span><br><span class="line">          rotateValue=<span class="number">180</span>+rotateValue;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/*移动到根部*/</span></span><br><span class="line">      canvas.translate(buttom.x, buttom.y);</span><br><span class="line">      canvas.rotate((<span class="keyword">float</span>) rotateValue);</span><br><span class="line">      Path path=<span class="keyword">new</span> Path();</span><br><span class="line">      path.moveTo(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">      path.quadTo(distance/<span class="number">2</span>,distance/<span class="number">4</span>,distance,<span class="number">0</span>);</span><br><span class="line">      path.moveTo(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">      path.quadTo(distance/<span class="number">2</span>,-distance/<span class="number">4</span>,distance,<span class="number">0</span>);</span><br><span class="line">      canvas.drawPath(path,getTextPaint());</span><br><span class="line">      canvas.restore();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>这里为了方便画图，要记得保存图层来画图</p>
<p>偏移的角度atan可能是负数，也就是叶子在左边的情况下。反过来计算出需要旋转的角度rotateValue</p>
<p>知道了角度之后，把画布旋转过来，画布原点在叶子根部，叶子定点在x轴方向，这样画二阶贝塞尔曲线就很容易啦。贝塞尔曲线的控制点目前定义在中点，高度为距离的四分之一。画完记得恢复画布</p>
<h3 id="画一颗小草"><a href="#画一颗小草" class="headerlink" title="画一颗小草"></a>画一颗小草</h3><p>因为可能有很多的小草，需要定义小草类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/**小草高度，默认是2，一个单位高度是一个二阶贝塞尔曲线弧*/</span><br><span class="line"> int height=5;</span><br><span class="line"> /**每一个单位高度的真实高度*/</span><br><span class="line"> float radianHeight=300;</span><br><span class="line"> /**小草扭动幅度，也就是控制点偏移量*/</span><br><span class="line"> float radianOffset=radianHeight/4;</span><br><span class="line"> /**小草的根部位置*/</span><br><span class="line"> Point rootPostion=null;</span><br><span class="line"> /**</span><br><span class="line">  * 叶子和茎的偏移角度</span><br><span class="line">  *</span><br><span class="line">  * */</span><br><span class="line"> float angle=60;</span><br><span class="line"> /**</span><br><span class="line">  * 叶子的数量，不包括顶部一个</span><br><span class="line">  * 目前先暂定，一个弧度只有一个叶子，其实可以控制更多</span><br><span class="line">  * TODO 自定义多个叶子</span><br><span class="line">  * */</span><br><span class="line"> int leafNumber=height;</span><br></pre></td></tr></table></figure>
<p>小草类还待继续完善。小草是婀娜多姿的，那么其实是很多二阶贝塞尔曲线拼起来的。一个二阶曲线这里定义为一个单位高度，也就是height，每个height具体高度radianHeight ，小草扭动的幅度，也就是二阶控制点距离中心轴的位置。还有就是小草的根部位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">canvas.save();</span><br><span class="line">/*移动到根部*/</span><br><span class="line">canvas.translate(rootPostion.x,rootPostion.y);</span><br><span class="line">Path path=new Path();</span><br><span class="line">path.moveTo(0,0);</span><br><span class="line">for (int i=1;i&lt;height+1;i++)&#123;</span><br><span class="line">    Point p1=new Point((int)radianOffset,(int)((i-1)*radianHeight+radianHeight/2));</span><br><span class="line">    Point p2=new Point(0, (int) (radianHeight*i));</span><br><span class="line">    path.quadTo(p1.x,p1.y,p2.x,p2.y);</span><br><span class="line"></span><br><span class="line">    Point p0=new Point(0, (int) ((i-1)*radianHeight));</span><br><span class="line">    Point buttom=calculateBerzierTwo(p0,p1,p2,0.5f);</span><br><span class="line">    Point top=new Point();</span><br><span class="line">    top.x= (int) (buttom.x+radianOffset);</span><br><span class="line">    top.y= (int) (buttom.y+radianHeight/3);</span><br><span class="line">    radianOffset=-radianOffset;</span><br><span class="line">   // canvas.drawLine(0,0,0,radianHeight*height,getTextPaint());</span><br><span class="line">   // canvas.drawCircle(buttom.x,buttom.y,20,getTextPaint());</span><br><span class="line">    new Leaf(top,buttom).drawSelf(canvas);</span><br><span class="line">&#125;</span><br><span class="line">canvas.drawPath(path,getTextPaint());</span><br><span class="line">canvas.restore();</span><br></pre></td></tr></table></figure>
<p>把画布移动到根部，然后开始画二阶曲线。二阶曲线的起点终点控制点都在y轴网上附近，都很容易找到。但是这里有一个叶子生成的位置需要注意一下。目前叶子生成位置都是在扭动的拐弯处。</p>
<p>所以拐弯处的点，定义为叶子的根部，根部的位置确认是通过二阶贝塞尔曲线的函数去确认的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public float getBerzierTwo(float p0,float p1,float p2,float t)&#123;</span><br><span class="line">      return (1-t)*(1-t)*p0+2*t*(1-t)*p1+t*t*p2;</span><br><span class="line">  &#125;</span><br><span class="line">  public Point calculateBerzierTwo(Point p0,Point p1,Point p2,float t)&#123;</span><br><span class="line">      Point bPoint=new Point();</span><br><span class="line">      bPoint.x= (int) getBerzierTwo(p0.x,p1.x,p2.x,t);</span><br><span class="line">      bPoint.y= (int) getBerzierTwo(p0.y,p1.y,p2.y,t);</span><br><span class="line">      return bPoint;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>这两个函数是二阶函数的原理函数，其实直接用这个函数去画二阶线也行，我之前用过，但是考虑到系统已经提供了方法，就用系统的，性能肯定更好。然后我们是用这个函数用来确定点位置的。</p>
<p>确定了根部位置，在确定叶子的顶部位置其实只是根绝根部进行了一个小偏移。没什么可说</p>
<p>然后再循环过程中就画了一下叶子，最后画小草。</p>
<h3 id="一堆草"><a href="#一堆草" class="headerlink" title="一堆草"></a>一堆草</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/*y轴翻转*/</span><br><span class="line">canvas.scale(1,-1);</span><br><span class="line">/*画布向下平移*/</span><br><span class="line">canvas.translate(0,-mHeight);</span><br><span class="line">Random random=new Random();</span><br><span class="line">for (int i=0;i&lt;20;i++)&#123;</span><br><span class="line">    Point point=new Point();</span><br><span class="line">    point.y=0;</span><br><span class="line">    point.x=random.nextInt(10)*mWidth/10;</span><br><span class="line"></span><br><span class="line">    new Grass(random.nextInt(10),150+random.nextFloat()*150f,point).drawSelf(canvas);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最外层最简单，随机生成不同高度的小草</p>
<p><a href="https://github.com/yeqinfu/ClockView" target="_blank" rel="noopener">源码位置</a></p>

      
    </div>
    <footer class="article-footer">
      <ul class="article-meta">
        <li>
          <span class="label">Published Date:</span>
          <a href="/2019/05/27/自定view-花花草草/" class="article-date">
  <time datetime="2019-05-27T14:00:58.000Z" itemprop="datePublished">2019-05-27</time>
</a>

        </li>
        
        
          <li>
            <span class="label">Tag:</span>
            
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>


          </li>
        
        <hr/>
      </ul>
    </footer>
  </div>
  
    
<nav id="article-nav" class="article-nav">
  
    <a href="/2019/11/19/GitAction使用/" id="article-nav-newer" class="article-nav-link-wrap newer">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          GithubAction 使用
        
      </div>
    </a>
  
  
    <a href="/2019/05/27/自定义view-网红时钟/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">自定义view-网红时钟</div>
    </a>
  
</nav>


  
</article>




      </div>
      
    <footer id="footer" class="post-footer footer">
      <hr/>
      <div id="footerContent" class="footer-content">
        <p>老铁，我是底线</p>


      </div>
    </footer>

      

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/typing.js"></script>
<!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->







    </div>
  </body>
</html>
